<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Tasks</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>
</head>

<body>
    <button id="convert">Markdownに変換</button>
    <pre id="output"></pre>
    <div id="editor_holder"></div>

    <script>
        // スキーマの読み込み
        fetch('schemas/tasklist.json')
            .then(response => response.json())
            .then(schema => {
                // JSONエディタの初期化
                const editor = new JSONEditor(document.getElementById('editor_holder'), {
                    schema: schema,
                    theme: 'bootstrap4'
                });

                // 変換ボタンのイベントリスナー
                document.getElementById('convert').addEventListener('click', () => {
                    const data = editor.getValue();
                    const markdown = convertToMarkdown(data);
                    document.getElementById('output').textContent = markdown;
                });
            });

        // JSONデータをMarkdown表形式に変換する関数
        function convertToMarkdown(data) {
            let markdown = '| 項目 | 得点 |\n| ---- | ---- |\n';

            // 各項目の得点計算とテーブル行の追加
            function calculateScore(value) {
                if (typeof value === 'boolean') {
                    return value ? 100 : 0;
                }
                if (typeof value === 'object') {
                    if (Array.isArray(value)) {
                        return value.reduce((sum, item) => sum + (item.得点 || 0), 0);
                    }
                    // オブジェクトの場合は全てのプロパティが必須値を満たしていれば100点
                    return Object.values(value).every(v => v !== undefined && v !== null) ? 100 : 0;
                }
                return 0;
            }

            // 必須項目の処理
            ['起床', '散歩', '朝食', '体操', '労働', 'ジム', '勉強会', '個人開発', '歯磨き'].forEach(item => {
                const score = calculateScore(data[item]);
                markdown += `| ${item} | ${score} |\n`;
            });

            // その他の項目の処理（配列）
            if (data.その他 && Array.isArray(data.その他)) {
                data.その他.forEach(item => {
                    markdown += `| ${item.題目} | ${item.得点} |\n`;
                });
            }

            return markdown;
        }
    </script>
</body>

</html>
